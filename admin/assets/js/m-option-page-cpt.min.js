import{optTable as e}from"./m-option-page-cpt-table.min.js?v=1727180045";import{page as t}from"./m-option-page-cpt-page.min.js?v=1727180045";import{showSpinner as a,popupAlert as o,dialogBox as n}from"../../../lib/assets/js/general/m-general.min.js?v=1727180045";const d=jQuery;window.actions={edit(a){t.clear(),t.fillData(e.row(a).data().id,e.row(a).data().details),d("#rds-list").addClass("hide"),d(".btn-add-page").addClass("hide"),t.show()},delete(e){s(e).open()},download(e){!function(e,t,a){const o=document.createElement("a"),n=new Blob([e],{type:a});o.href=URL.createObjectURL(n),o.download=t,o.click()}(JSON.stringify(table.row(e).data().details),table.row(e).data().slug+".json","text/plain")},open(t){a();const o=document.getElementById("option-page-list").getAttribute("data-admin-url"),n=e.row(t).data(),d="sub_menu"==n.type&&n.menu.includes(".php")?n.menu:"admin.php";window.open(`${o}${d}?page=${n.slug}`,"_self")}};const s=e=>{const t=new n("dlg-remove-row");return t.title="Delete Confirmation",t.content="Are you sure you want to remove this option?",t.addButton(["Yes","No"]),t.addEventListener("buttonClick",(t=>{if("Yes"==t.detail.text){a(!0);const t=wpApiSettings.root+document.getElementById("option-page-list").getAttribute("data-endpoint")+"/"+table.row(e).data().id,n="delete";d.ajax({url:t,method:n,beforeSend:e=>{e.setRequestHeader("X-WP-Nonce",wpApiSettings.nonce)},success:function(t){table.row(e).remove(),table.draw(!1),a(!1)},error:function(e){const t=e.responseJSON;console.log(e),o("Delete Failed",t.message),a(!1)}})}t.target.close()})),t.addEventListener("open",(t=>{table.rows(e).nodes().to$().css("color","red").css("font-weight","600")})),t.addEventListener("close",(t=>{table.rows(e).nodes().to$().css("color","").css("font-weight",""),t.target.node.remove(),document.querySelector(".btn-add-page").focus()})),t};d(document).ready((function(){t.addEventListener("saved",(e=>{const t=e.target.post_id;let a=null;if(t){let o;table.rows().every((function(n,d,s){this.data().id==t&&(o="menu"==e.target.type?e.target.slug:e.target.parent_menu,this.data().title=e.target.title,this.data().slug=e.target.slug,this.data().capability=e.target.capability,this.data().type=e.target.type,this.data().menu=o,this.data().details=e.detail.json,this.invalidate(),a=n)}))}null===a&&table.row.add({id:t,title:e.target.title,slug:e.target.slug,capability:e.target.capability,type:e.target.type,menu:e.target.menu_title,details:e.detail.json}),table.draw(!1)})),d(".btn-close-page").on("click",(()=>{t.close(),document.querySelector(".btn-add-page").focus()})),d(".btn-add-page").on("click",(()=>{t.clear(),d("#rds-list").addClass("hide"),d(".btn-add-page").addClass("hide"),t.show()})),d(".btn-add-json").on("click",(()=>{(e=>{const a=new n("dlg-json-upload");return a.title="Choose JSON file",a.content=()=>'<div style="padding: 8px;"><input type="file" id="json-file"  accept="application/JSON"/></div>',a.addButton(["Upload","Cancel"]),a.addEventListener("buttonClick",(e=>{if("Upload"==e.detail.text){const e=document.getElementById("json-file");if(0==e.files.length)return void o("No File Choosen","Please choose JSON file first");fetch(URL.createObjectURL(e.files[0])).then((e=>e.json())).then((e=>{t.clear(),d("#rds-list").addClass("hide"),d(".btn-add-page").addClass("hide"),t.show(),t.fillData("",e)}))}e.target.close()})),a.addEventListener("close",(e=>{e.target.node.remove(),document.querySelector(".btn-add-json").focus()})),a})().open()})),document.querySelector(".btn-add-page").focus(),window.table=e}));