import{fBoxList as e,createFBox as t}from"../../../lib/assets/js/fieldbox/m-fieldbox.min.js?v=1727180045";import{iconBox as s}from"../../../lib/assets/js/iconbox/m-iconbox.min.js?v=1727180045";import{setErrorMessage as i}from"../../../lib/assets/js/m-utils.min.js?v=1727180045";import{elBinder as a,showSpinner as n,popupAlert as d,dialogBox as o,getFormValue as l}from"../../../lib/assets/js/general/m-general.min.js?v=1727180045";import{adminFlashNotice as r}from"../../../lib/assets/js/m-admin.min.js?v=1727180045";window.fBoxList=e;const c=jQuery,p=new s("iconbox");class h extends a{node;#e=document.querySelector("form");constructor(){super();const t=this;this.node=document.getElementById("rds-form"),this.node.querySelectorAll("[data-handle]").forEach((e=>{this._bind(e,e.getAttribute("data-handle"))})),this.addEventListener("input",(e=>{const s=e.detail.handle;if("post_id"==s&&(t.post_id?(c(".btn-save-page").html("Update"),t.elBinded("slug").readOnly=!0):(c(".btn-save-page").html("Create"),t.elBinded("slug").readOnly=!1)),"type"==s){const s="menu"==e.detail.value;t.elBinded("parent_menu").closest("tr").classList.toggle("hide",s),t.elBinded("menu_title").closest("tr").classList.toggle("hide",!s),t.elBinded("page_icon").closest("tr").classList.toggle("hide",!s)}"page_icon"==s&&(t.elBinded("btn_icon").removeAttribute("class"),t.elBinded("btn_icon").setAttribute("class","button button-secondary dashicons-before "+t.page_icon))})),this.addEventListener("buttonClick",(e=>{"btn_icon"==e.detail.handle&&p.open()})),this.addEventListener("saved",(s=>{t.post_id=s.detail.id,Object.values(e.list).forEach((e=>{t.#t(e),t.#s(e)})),t.setLastData()})),this.elBinded("slug").setAttribute("data-valid-handle","page_slug"),this.#i(),this.#e.addEventListener("input",this.#a),c(".btn-save-page").on("click",(()=>{t.saveData()}))}#n;setLastData(){this.#n=l(this.#e)}saveData(){const t=this;if(n(!0),c(".rds-input:visible").each((function(){u(this)})),Object.values(e.list).forEach((e=>{if(!e.node.classList.contains("expanded")){e.node.classList.add("expanded");const t=c(e.node);t.find(".rds-input:visible").each((function(){u(this)})),0==t.find(".rds-error-message:visible").length&&e.node.classList.remove("expanded")}})),0!=c(".rds-error-message:visible").length)return d("Data Validation","Save failed, please check your input!"),void n(!1);const s={title:this.title,slug:this.slug,description:this.description,capability:this.capability,type:this.type,parent:this.parent_menu,menu_title:this.menu_title,icon:this.page_icon,position:this.position,fields:[{type:"form_table",name:this.slug+"_aft",fields:e.getValues()}]},i=wpApiSettings.root+this.#e.getAttribute("data-endpoint")+(this.post_id?"/"+this.post_id:""),a=this.post_id?"put":"post";c.ajax({url:i,method:a,data:JSON.stringify(s),dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:e=>{e.setRequestHeader("X-WP-Nonce",wpApiSettings.nonce)},success:e=>{t.dispatchEvent(new CustomEvent("saved",{detail:{id:e.data.id,json:s}})),n(!1),r("success",e.message)},error:e=>{n(!1),e.hasOwnProperty("responseJSON")&&e.responseJSON.hasOwnProperty("message")?d("Save Failed",e.responseJSON.message):r("error",e.responseText,1e4)}})}fillData(e,s){try{this.post_id=e,this.title=s.title,this.slug=s.slug,this.description=s.description,this.capability=s.capability,this.type=s.type,this.parent_menu=s.parent,this.menu_title=s.menu_title,this.page_icon=s.icon,this.position=s.position,s.fields[0].fields.forEach((e=>{t(e,0,{after:e=>{this.post_id&&(this.#t(e),this.#s(e))}})}))}catch(e){console.error(e.message)}}#t(e){e.elBinded("btn_shortcode").disabled&&(e.elBinded("btn_shortcode").disabled=!1,e.addEventListener("buttonClick",(t=>{"btn_shortcode"==t.detail.handle&&(e=>{const t=new o("dlg-shortcode"),s=(e,t,s)=>{const i=document.createElement("div"),a=document.createElement("div"),n=document.createElement("input"),d=document.createElement("label"),o=document.createElement("button");return d.textContent=t,d.setAttribute("for",e),n.id=e,n.value=s,n.setAttribute("style","width: 320px;"),n.setAttribute("type","text"),n.readOnly=!0,o.setAttribute("class","no-button dashicons dashicons-clipboard"),o.addEventListener("click",(async e=>{n.select(),n.setSelectionRange(0,99999);try{await navigator.clipboard.writeText(n.value)}catch(e){document.execCommand("copy")}r("success","Copied the text: "+n.value)})),a.setAttribute("style","display: flex;align-items: center;column-gap: 4px;"),a.append(n),a.append(o),i.setAttribute("style","display: flex; flex-direction: column; row-gap: 4px; padding: 8px 0;"),i.append(d),i.append(a),i};return t.title="Code for "+e.elBinded("fbox_title").innerHTML+" field",m.slug,e.name,t.appendContent(s("sc","WordPress Shortcode:",`[${m.slug} field=${e.name}]`)),t.appendContent(s("go","PHP:",`get_option("${m.slug}")["${e.name}"]`)),t.addButton("Close"),t.addEventListener("buttonClick",(e=>{e.target.close()})),t.addEventListener("close",(t=>{t.target.node.remove(),e.elBinded("btn_shortcode").focus()})),t})(e).open()})))}#s(e,t=!0){e.elBinded("type").disabled=t,e.elBinded("type").classList.toggle("rds-bold",t),e.elBinded("btn_generate_id").classList.toggle("hide",t),e.elBinded("name").readOnly=t}#i(){const e=this;p.addEventListener("open",(t=>{e.page_icon&&t.target.elBinded(e.page_icon).focus()})),p.addEventListener("close",(t=>{e.elBinded("btn_icon").focus()})),p.addEventListener("iconClick",(t=>{e.page_icon=t.detail.icon,t.target.close()}))}#a(e){u(e.target)}clear(){this.post_id="",this.title="",this.slug="",this.description="",this.capability="manage_options",this.type="menu",this.parent_menu="",this.menu_title="",this.page_icon="dashicons-admin-generic",this.position="",this.slug="",Object.keys(e.list).forEach((t=>{e.remove(t)})),c(".rds-error-message").html("")}show(){c("#rds-form").removeClass("hide"),c(".btn-warpper-header").removeClass("hide"),this.elBinded("title").focus(),this.setLastData()}#d(){const e=new o("dlg-close-page");return e.title="Close Confirmation",e.content="Are you sure that you want to close the current page? The changes that you made won't be saved.",e.addButton(["Yes","No"]),e.addEventListener("buttonClick",(e=>{"Yes"==e.detail.text&&(c("#rds-list").removeClass("hide"),c(".btn-add-page").removeClass("hide"),c("#rds-form").addClass("hide"),c(".btn-warpper-header").addClass("hide")),e.target.close()})),e.addEventListener("close",(e=>{e.target.node.remove()})),e}close(){this.#n!=l(this.#e)?this.#d().open():(c("#rds-list").removeClass("hide"),c(".btn-add-page").removeClass("hide"),c("#rds-form").addClass("hide"),c(".btn-warpper-header").addClass("hide"))}}const u=e=>{i(e);const t=e.getAttribute("data-valid-handle");if("page_slug"==t){let t=/^\w+$/;if(""!=e.value&&!t.test(e.value))return i(e,"This field may only contain letters, numbers, and underscores"),!1}if("field_name"==t){e.setAttribute("data-val",e.value);let s=/^\w+$/;if(""!=e.value&&!s.test(e.value))return i(e,"This field may only contain letters, numbers, and underscores"),!1;const a=document.querySelectorAll('[data-valid-handle="'+t+'"][data-val="'+e.value+'"]');if(a.length>1)return a.forEach((t=>{t.setAttribute("data-duplicate",e.value),i(t,"This field cannot be duplicates")})),!1;{const s=e.getAttribute("data-duplicate");if(s){e.removeAttribute("data-duplicate");const a=document.querySelectorAll('[data-valid-handle="'+t+'"][data-val="'+s+'"]');1==a.length&&a.forEach((e=>{e.removeAttribute("data-duplicate"),i(e)}))}}}e.checkValidity()||i(e,e.validationMessage)},m=new h;export{h as optPage,m as page};